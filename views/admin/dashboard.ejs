<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
    <div class="dashboard-container">
        <header class="dashboard-header">
            <h1>Dashboard - <span id="business-name">Meu Neg√≥cio</span></h1>
            <div class="user-actions">
                <span id="user-greeting">Ol√°, Vendedor!</span>
                <button onclick="logout()" class="btn-logout">Sair</button>
            </div>
        </header>

        <div class="dashboard-grid">
            <!-- Status WhatsApp -->
            <div class="card">
                <h3>Status WhatsApp</h3>
                <div id="whatsapp-status" class="status disconnected">
                    <span>Desconectado</span>
                </div>
                <div id="qrcode-container" class="hidden">
                    <img id="qrcode" src="" alt="QR Code">
                    <p>Escaneie com seu WhatsApp</p>
                </div>
                <button id="connect-btn" onclick="connectWhatsApp()" class="btn-primary">
                    Conectar WhatsApp
                </button>
            </div>

            <!-- Configura√ß√µes do Neg√≥cio -->
            <div class="card">
                <h3>Configura√ß√µes do Neg√≥cio</h3>
                <form id="business-config-form">
                    <div class="form-group">
                        <label>Nome do Neg√≥cio</label>
                        <input type="text" id="business-name-input" required>
                    </div>
                    <div class="form-group">
                        <label>Segmento</label>
                        <select id="business-type">
                            <option value="varejo">Varejo</option>
                            <option value="servicos">Servi√ßos</option>
                            <option value="restaurante">Restaurante</option>
                            <option value="imoveis">Im√≥veis</option>
                            <option value="outros">Outros</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Mensagem de Boas-Vindas</label>
                        <textarea id="welcome-message" rows="3"></textarea>
                    </div>
                    <button type="submit" class="btn-primary">Salvar Configura√ß√µes</button>
                </form>
            </div>

            <!-- Menu de Atendimento -->
            <div class="card">
                <h3>Menu de Atendimento</h3>
                <div id="menu-options-container">
                    <!-- Op√ß√µes ser√£o carregadas via JavaScript -->
                </div>
                <button onclick="addMenuOption()" class="btn-secondary">+ Adicionar Op√ß√£o</button>
            </div>

            <!-- Cat√°logo de Produtos -->
            <div class="card">
                <h3>Cat√°logo de Produtos</h3>
                <div id="products-container">
                    <!-- Produtos ser√£o carregados via JavaScript -->
                </div>
                <button onclick="addProduct()" class="btn-secondary">+ Adicionar Produto</button>
            </div>

            <!-- Estat√≠sticas -->
            <div class="card">
                <h3>Estat√≠sticas</h3>
                <div class="stats-grid">
                    <div class="stat-item">
                        <span class="stat-number" id="total-conversations">0</span>
                        <span class="stat-label">Conversas Hoje</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="total-customers">0</span>
                        <span class="stat-label">Clientes Atendidos</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="conversion-rate">0%</span>
                        <span class="stat-label">Taxa de Convers√£o</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const token = localStorage.getItem('token');
        const user = JSON.parse(localStorage.getItem('user') || '{}');
        
        if (!token) {
            window.location.href = '/admin/login';
        }

        document.getElementById('user-greeting').textContent = `Ol√°, ${user.name || 'Usu√°rio'}!`;

        const socket = io({
            auth: {
                token: token
            }
        });

        // Resto do c√≥digo do dashboard (conex√£o WhatsApp, carregar configura√ß√µes, etc.)
        // ... (c√≥digo JavaScript para gerenciar o dashboard)

        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            window.location.href = '/admin/login';
        }

        // Carregar configura√ß√µes do neg√≥cio
        async function loadBusinessConfig() {
            try {
                const response = await fetch('/api/business-config', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (response.ok) {
                    const config = await response.json();
                    document.getElementById('business-name').textContent = config.businessName;
                    document.getElementById('business-name-input').value = config.businessName;
                    document.getElementById('business-type').value = config.businessType;
                    document.getElementById('welcome-message').value = config.welcomeMessage;
                    
                    loadMenuOptions(config.menuOptions);
                    loadProducts(config.products);
                }
            } catch (error) {
                console.error('Erro ao carregar configura√ß√µes:', error);
            }
        }

        // Carregar op√ß√µes do menu
        function loadMenuOptions(menuOptions) {
            const container = document.getElementById('menu-options-container');
            container.innerHTML = menuOptions.map((option, index) => `
                <div class="menu-option">
                    <input type="text" value="${option.keyword}" placeholder="Palavra-chave" 
                           onchange="updateMenuOption(${index}, 'keyword', this.value)">
                    <input type="text" value="${option.description}" placeholder="Descri√ß√£o"
                           onchange="updateMenuOption(${index}, 'description', this.value)">
                    <textarea onchange="updateMenuOption(${index}, 'response', this.value)"
                              placeholder="Resposta">${option.response}</textarea>
                    <button onclick="removeMenuOption(${index})">üóëÔ∏è</button>
                </div>
            `).join('');
        }

        // Inicializar
        document.addEventListener('DOMContentLoaded', function() {
            loadBusinessConfig();
            // loadStats();
        });
    </script>
</body>
</html>